<html>
	<head>
		<base href="/yard/html/" />
		<link href="css/bootstrap-theme.min.css" rel="stylesheet">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<script src="js/jquery-2.1.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
		
		

        <style>
			.navbar-nav>li>a:hover{
				background-color:rgb(255, 204, 0);
			}
			label{
				margin-top:6px;
			}
        </style>
		
		
       <script language="JavaScript" src="js/Config.js"></script>
	   <script language="JavaScript" src="js/DhlStyle.js"></script>
       

        <script>
		 
		
		var ErrorMap=new Array();
		ErrorMap["addBerth.do"]="添加";
		ErrorMap["selectBerthList.do"]="查询";
		ErrorMap["updateBerthInfo.do"]="修改";
		ErrorMap["deleteBerthInfo.do"]="删除";	
		

		var ajax_data=
		[
				{
					sid: 1,
					bid: 1,
					supplier_name: "五菱",
					berth_number: "泊位1号",
					berth_status: 1
				},
				{
					sid: 1,
					bid: 2,
					supplier_name: "五菱",
					berth_number: "泊位2号",
					berth_status: 0
				},
				{
					sid: 1,
					bid: 3,
					supplier_name: "五菱",
					berth_number: "泊位3号",
					berth_status: 0
				},
				{
					sid: 1,
					bid: 4,
					supplier_name: "五菱",
					berth_number: "泊位4号",
					berth_status: 1
				}
		]
		var Temp_Data=
			{
				SupplyName:"五菱",
				berth_id:"2",
				CurrentNumber:"3",
				PlanNumber:"4",
				plate_number:"",
				waiting_berth_number:""
			}
        window.onload = function(){	
			InitTemplate()
			UseDhlStyle();
			
			//查询方法绑定
			BindFunction("#Query_Submit",null,function(){
				ReBind();
			});

        }			
			
		function ReBind(){
			//发送查询请求
				AjaxGet(BaseServer+"plan/getSupplierBerthMapList.do?supplier_name="+GetContent("#Query_Dialog"),null,

				function(status,msg){
	
					BindDataTo("#AjaxTable",msg.data,null,StatusConvetor);
	
					BindFunction("#AjaxTable","添加",function(flag,data,node){
						
						AjaxGet("",data,function(plan_status,plan_msg){
							BindDataTo("#Add_Dialog",plan_msg.data);
							BindFunction("#Add_Submit","#Add_Dialog",function(plan_flag,plan_data,plan_node){
								AjaxPost("/plan/addAdditionalBerthPlan.do",plan_data,function(r_status,r_msg){
									if(r_msg.result==1){
										CloseBootstrapModal("#Add_Dialog");
									}
								});
							});
						});
					});
				},function(status,msg){
					BindDataTo("#AjaxTable",ajax_data,null,StatusConvetor);
					BindFunction("#AjaxTable","添加",function(flag,data,node){
						BindDataTo("#Add_Dialog",Temp_Data);
					});
				});
		}
		
		function WebSocket(){
			var shut =0;
			window.setInterval(function(){
					shut+=1;
					if(shut%2==0)
					{
						var ajax1=
						[
							{
								bid: 1,
								berth_number: "泊位1号",
								berth_status: 1
							},
							{
								bid: 2,
								berth_number: "泊位2号",
								berth_status: 0
							},
							{
								bid: 3,
								berth_number: "泊位3号",
								berth_status: 1
							},
							{
								bid: 4,
								berth_number: "泊位4号",
								berth_status: 0
							}
						]
						CuminData.CreateInstance("#AjaxTable").PropertyChanged("#StatusMonitor",ajax1);
						
					}else{
					
						var ajax2=
						[
							{
								bid: 1,
								berth_number: "泊位1号",
								berth_status: 0
							},
							{
								bid: 2,
								berth_number: "泊位2号",
								berth_status: 1
							},
							{
								bid: 3,
								berth_number: "泊位3号",
								berth_status: 0
							},
							{
								bid: 4,
								berth_number: "泊位4号",
								berth_status: 1
							}
						]
						CuminData.CreateInstance("#AjaxTable").PropertyChanged("#StatusMonitor",ajax2);
					}
				},2000); 
		}
        </script>
    </head>
	<body>

		<div id="dhlMenu">
			<div>
				<div class="btn-group">
					<img class="btn-group" id="dhlflag" class="img-responsive"/>
				</div>

				<div  class="btn-group" style="vertical-align:bottom;">
					<ul id="dhlMenuButton" class="nav navbar-nav">
						<li><a href="BerthManagement.html">泊位监控</a></li>
						<li><a href="BerthManagement.html">泊位管理</a></li>
						<li><a href="SupplieManagement.html">供应商管理</a></li>
						<li><a href="PlanAppend.html">计划追加</a></li>
						<li><a href="History.html">历史查询</a></li>
					</ul>
				</div>
			</div>
		</div>

		<div id="errorNode" >
			<div id="errorMessage">
				
			</div>
		</div>
		
		
		<!--Bootstrap增加模态框-->
		<div class="modal fade" id="add">
			<div class="modal-dialog" role="document" style="width:700px;">
				 <div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="partModalLabel">添加|泊位信息</h4>
					</div>
					<div class="modal-body">
						<div id="Add_Dialog" class="form-horizontal">
							<div template="berth_id">
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">供应商</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="SupplyName" placeholder="供应商" disabled>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">泊位号</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="berth_id" placeholder="泊位号" json disabled>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">当前排队序号</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="CurrentNumber" placeholder="当前排队序号" disabled>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">计划排队序号</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="PlanNumber" placeholder="计划排队序号" disabled>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">车牌号</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="plate_number" placeholder="车牌号" json>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-3 control-label text-right">等候泊位号</label>
									<div class="col-sm-9">
										<input type="text" class="form-control" field="waiting_berth_number" placeholder="等候泊位号" json>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
							<button id="Add_Submit" type="button" class="btn btn-primary">确定</button>
						</div>
					</div>
				</div>
			 </div>
		</div>
		<!--修改-->
		
		
		<form class="form-inline" role="form">
				<div class="form-group">
					<div  class="col-xs-3 col-sm-4" style="padding-right:0px">
					<label class="control-label">泊位号:</label>
					</div>
					<div class="col-xs-7 col-sm-8" style="padding:0px">
						<input type="text" id="Query_Dialog"  class="form-control"  placeholder="泊位号">
					</div>
					
				</div>
				<div class="form-group">
					<button id="Query_Submit" type="button" class="col-xs-2 col-sm-12 btn btn-default single" >
						<span class="glyphicon glyphicon-search" style="padding-top:2px;margin-bottom:4px;"></span>
					</button>
				</div>
		</form>
		
		
		
		<div style="margin:10px">
			<table class="table table-striped" style="font-size:12px">
				<thead>
					 <tr>
						<th>序号</th>
						<th>供应商</th>
						<th>泊位号</th>
						<th>状态</th>
						<th>操作</th>
						<th style="display:none">供应商ID</th>
						<th style="display:none">泊位ID</th>
					</tr>
				</thead>
				<tbody id="AjaxTable">
					<tr template>
						<td sortnumber></td>
						<td field="supplier_name" style="display:none"></td>
						<td field="berth_number"></td>
						<td field="berth_status"></td>
						<td field="sid" json style="display:none"></td>
						<td field="bid" json style="display:none"></td>
						<td>
							<a operator  data-toggle="modal" data-target="#add">添加</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</body>
</html>